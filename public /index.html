<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Time Chat</title> 
</head>
<body>
    <h1>Server is already</h1>
    <pre id="message" ></pre>
    <input type="text" id="messageContainer"/>
    <button id="sendmsj" title="Send">Send message</button>
    <script>
        (
            function ()  {

                let sendButton = document.querySelector("#sendmsj");
                let messages = document.querySelector("#message");
                const messageBox = document.querySelector("#messageContainer");


                let ws;

                const showMessage = (msj) => {
                    messages.textContent += ` \n\n${msj}`;
                    messages.scrollTop = messages.scrollHeight;
                    messages.value = "";
                }

                function init(){
                    if(ws) {
                        ws.onerror = ws.onopen = ws.onclose = null;
                        ws.close();
                    }

                    ws = new WebSocket('ws://localhost:9000');
                    ws.onopen = () => {
                        console.log('WebSocket Connected')
                    }

                    ws.onmessage = async ({data}) => {
                        showMessage(data)
                        console.log(await data.valueOf())
                    };

                    ws.onclose = () => {
                        ws = null
                    };

                    sendButton.onclick = () => {
                        if(!ws) {
                            showMessage('An error ocurred with WebSocket')
                            return ;
                        }
                        
                        ws.send(messageBox.value);
                        showMessage(messageBox.value);
                    }
                };

                init()
            }  
        )()
    </script>
</body>
</html>